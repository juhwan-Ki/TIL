## 사용자 관리

### 1-1. root 사용자 관리

- su 명령어 
    - 다른 사용자로 전환하는 명령어
    - 주요 옵션
    - `[-]` : 전환하는 사용자의 초기화 파일을 실행
        - EX) su – root → root의 환경 변수를 적용하고 전환
    - `[-c]` : 계정 변환 없이 특정 명령어만 실행 (sudo 명령어와 같은 기능)
        - ex)  su -c ‘cat /etc/passwd’ – root → root 권한으로 해당 명령을 실행
        - su 명령어로 사용자 전환 후의 위치는 동일
- root 계정 관리 
    - root 계정의 UID 값은 0
    - root 이외에 UID가 0인 사용자가 없도록 해야 함
    - `TMOUT`환경 변수를 사용해 일정시간 미사용시 자동으로 로그아웃 되도록 설정하여 보안을 강화
    - 사용자 인증 모듈인 PAM을 이용해 root 계정으로의 직접 로그인을 차단
    - 일반 사용자에게 특정 명령어에 대한 root 권한이 필요할 때는 su 명령어보다는 sudo 명령어를 이용

### 1-2. 사용자 계정 관리

- /etc/passwd  
    - 시스템에 등록된 사용자의 정보들이 담겨져 있는 파일로 사용자의 계정 인증을 관리하는데 사용
    - 과거에는 사용자의 패스워드를 저장 하였는데 현재는 /etc/shadow에 암호화 된 패스워드를 저장
    - 총 7개의 필드로 구분 되며 각각의 필드는 콜론`(:)`으로 구분됨
        
        ```bash
        root:           # 1
        x:              # 2
        0:              # 3
        0:              # 4
        root:           # 5
        /root:          # 6
        /root:/bin/bash # 7
        ```
        
        1. 사용자 계정명 
        2. 패스워드 : 패스워드 필드
            - x : 패스워드가 /etc/shadow에 저장되어 있음을 나타댐
            - 비어있음 : 비밀번호가 없음
        3. UID : 사용자의 UserID → root는 0
        4. GID : 사용자의 GroupID → root는 0
        5. comment : 사용자와 관련한 기타 정보를 입력(일반적으로 사용자의 이름을 나타냄)
        6. 홈 디렉토리 : 사용자의 홈 디렉토리를 의미
        7. 로그인 쉘 : 사용자가 로그인시에 사용할 쉘을 의미 
            - 해당 필드가 /usr/sbin/nologin, /bin/false, /sbin/nologin 등으로 표시되면 해당 사용자는 로그인이 불필요한 어플리케이션을 의미
- /etc/shadow
    - 암호화된 패스워드와 패스워드 설정 정책이 기재되어 관리자 계정과 관리자 그룹만 읽을 수 있음
    - 총 8개의 필드로 구분 됨
        
        ```bash
        root:  # 1
        $y$j9T$srVW63McxQ5vZNUbXBqll/$BRVKpBxkTnr98ksmpv4nfoASHk7sVoS7HsKBVE1GME5: # 2
        19807: # 3
        0:     # 4
        99999: # 5
        7:     # 6
        :      # 7
        :      # 8
        ```
        
        1. 사용자 계정명
        2. 암호화된 패스워드 : `$`로 필드가 구분 되어 있음
            - **$algorithm_id$salt$encrypted_password**
                - **algorithm_id** : 암호학적 해시의 id를 의미
                    - 1 : MD5(가장 취약한 단방향 해쉬로 요즘에는 쓰지 않음)
                    - 2 : BlowFish
                    - 5 : SHA-256
                    - 6 : SHA-512
                    - y : yescrypt
                - **salt :** 각 해쉬에 첨가할 랜덤
                - **encrypted_password**:  알고리즘과 salt로 패스워드를 암호화한 값
            - 비밀번호가 아닌 다른 값이 있을 수 있음
                - `*` : 패스워드가 잠긴 상태로 로그인 할 수 없음
                - `!` : 패스워드가 잠신 상태로 로그인 할 수 없음 or 패스워드 생성하지 않은 상태
                - `빈값` :  패스워드가 설정되지 않음
        3. 최근 비밀번호 변경 날짜 :1970년 1월 1일(유닉스 타임의 시작일) 이후의 일수
        4. 비밀번호 변경 최소 일수 : 비밀번호 변경 간 최소 일수, 0이면 바로 변경 가능
        5. 비밀번호 변경 최대 일수 : 비밀번호를 유지할 수 있는 최대 일수, 99999면 사실상 무제한
        6. 비밀번호 만료 경고 일수 : 비밀번호 만료 전에 사용자에게 경고를 시작하는 일수
        7. 계정 비활성화 기간 : 비밀번호 만료 후 계정 비활성화하기까지의 기간
        8. 계정 만료 날짜 : 계정의 만료 날짜
        9. 예약된 필드 : 미래 사용을 위해 항상 비어 있는 값

### 1-3. 그룹 계정 관리

- /etc/group 파일 
    - 파일 내용 구성
        - 그룹 명 : 그룹 패스워드 : GID : 그룹 멤버
    - /etc/passwd 파일에는 기본 그룹의 GID가 저장되고, /etc/group 파일에는 2차 그룹의 정보가 저장
- /etc/gshadow 파일
    - 파일 내용 구성
        - 그룹 명 : 암호화 된 그룹 패스워드 : 관리자 : 그룹 멤버

### 1-4. 관련 명령어

- useradd 명령어 
    - 사용자 계정을 생성하는 명령어
    - 주요 옵션
        - `[-u]` : UID 지정
        - `[-o]` : UID의 중복을 허용
        - `[-g]` : 기본 그룹의 GID 지정
        - `[-G]` : 2차 그룹의 GID 지정
        - `[-d]` : 홈 디렉터리 지정
        - `[-s]` : 기본 쉘을 지정
        - `[-c]` : 코멘트 지정
        - `[-D]`: 기본 값을 설정하거나 출력 (/etc/default/useradd 파일 내용)
        - `[-e]`: 유효 기간 지정 (/etc/shadow 파일의 expires 항목)
        - `[-f]` : 비활성 일수 지정 (/etc/shadow 파일의 inactive 항목)
            - ex)  useradd -u 500 -G 10 -s /bin/bash -e 2018-12-31 testuser → testuser 사용자의 UID는 500, GID가 10인 2차그룹, 기본 쉘은 bash, 유효기간은 2018-12-31 까지로 설정하여 생성
            - 옵션 없이 계정 생성할 경우 패스워드를 설정하지 않았기 때문에 
            /etc/shadow 파일에 패스워드 항목이 !!로 지정 (패스워드가 잠겨 있다는 기호)
- usermod 명령어 
    - 사용자 계정의 정보를 변경하는 명령어
    - 주요 옵션
        - useradd 명령어와 옵션이 동일
        - `[-l]` : 계정 이름 변경
        - `[-d]` : 사용자의 홈 디렉터리를 변하며 변경할 디렉터리는 미리 생성되어야 함
        -m과 같이 사용하면 사용하던 홈 디렉터리의 파일과 디렉터리도 같이 옮겨주므로 이 경우에는 디렉터리를 생성하지 않아도 됨
        - `[-m]` : 사용자의 홈 디렉터리 변경 시 기존에 사용하던 파일 및 디렉터리를 옮겨주는 옵션
        - `[-L]` : 사용자의 패스워드에 LOCK을 걸어 로그인을 막음
        - `[-U]` : 사용자의 패스워드에 걸린 LOCK을 해제
            - ex) usermod -l usertest testuser → testuser 사용자의 이름을 usertest로 변경
- userdel 명령어 
    - 사용자 계정을 삭제하는 명령어
    - `[-r]` 옵션 : 홈 디렉터리 제거
- chage 명령어 
    - 패스워드 만료에 정보를 보여주거나 설정 하는 명령어
    - 주요 옵션
        - `[-l]` : 지정한 계정의 정보를 보여줌
        - `[-m]` : 패스워드 최소 의무 사용일 수를 지정 (passwd -n)
        - `[-M]` : 패스워드 변경 없이 사용할 수 있는 최대 일수 설정 (passwd -x)
        - `[-W]` : 패스워드 만료 며칠 전부터 사용자에게 경고 메시지를 보낼지 설정 (passwd -w)
        - `[-I]` : 패스워드 만료 시 비활성화 상태로 전환되기까지의 유예기간을 지정 (usermod -f)
        - `[-E]` :  ****계정의 만기일 설정 (usermod -e)
- passwd 명령어
    - 사용자 계정의 패스워드 변경/관리하는 명령어
    - 주요 옵션
        - `[-d]` : 비밀번호 삭제
        - `[-e]` : 강제적으로 비밀번호 만
        - `[-n]` : 패스워드 최소 의무 사용일 수를 지정
        - `[-x]` : 패스워드 변경 없이 사용할 수 있는 최대 일수 설정
        - `[-w]` : 패스워드 만료 며칠 전부터 사용자에게 경고 메시지를 보낼지 설정
        - `[-l]` : 계정 잠금(lock)
        - `[-u]` : 계정 잠금 해제(unlock)
- groupadd 명령어
    - 그룹을 생성하는 명령어
    - 주요 옵션
        - `[-g]` : GID 지정
        - `[-o]` : GID의 중복을 허용
        - `[-r]` : 500번 이하의 가장 빠른 GID를 생성
- groupmod 명령어 
    - 그룹의 정보를 변경하는 명령어
    - 주요 옵션
        - groupadd 명령어와 옵션이 동일
        - `[-n]` : 그룹 이름 변경
- groupdel 명령어 
    - 그룹을 삭제하는 명령어
    - 그룹을 삭제할 때 `해당 그룹에 속한 멤버가 없어야 함`
- gpasswd 명령어 
    - 그룹의 패스워드를 변경하거나 그룹에 계정을 추가/삭제하는 명령어
    - 주요 옵션
        - `[-a]` : 사용자 계정을 그룹에 추가
        - `[-d]` : 사용자 계정을 그룹에서 삭제
            - ex) gpasswd -a testuser testgroup → testgroup 그룹에 testuser 사용자를 추가
        - `[-r]` : 그룹 암호를 삭제
        - `[-A]` : 그룹의 관리자를 지정
            - ex) gpasswd -A testuser testgroup → testgroup 그룹의 관리자를 testuser 사용자를 관리자로 설정
- newgrp 명령어
    - 계정의 소속 그룹을 변경하는 명령어
        - ex) newgrp grp01 → grp01로 그룹을 변경
- who 명령어
    - 현재 시스템을 사용하는 사용자의 정보를 출력하는 명령어
    - 주요 옵션
    - [-q] : 사용자의 이름만 출력
    - [-H] : 출력 항목의 제목도 함께 출력 (Header)
    - [-b] : 마지막으로 재시작한 날짜와 시간을 출력 (boot)
    - [-r] : 현재 런레벨을 출력 (runlevel)
- w 명령어
    - 현재 시스템을 사용하는 사용자의 정보와 작업 정보를 출력하는 명령어
- id 명령어 
    - 현재 작업하고 있는 자신의 계정명, 그룹명, UID, GID를 출력하는 명령어
- users 명령어 
    - 현재 로그인 되어 있는 사용자의 계정을 출력
- groups 명령어
    - 사용자 계정이 속한 그룹을 출력
- lslogins 명령어 
    - 시스템 내에 있는 사용자 계정에 대한 정보를 출력
- pwck 명령어 
    - /etc/passwd 파일과 /etc/shadow 파일 내용의 무결성을 검사하는 명령어
- grpck 명령어 
    - /etc/group 파일과 /etc/gshadow 파일 내용의 무결성을 검사하는 명령어
