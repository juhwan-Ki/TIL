### Transaction이란?
- Transaction은 데이터베이스의 상태를 변환시키는 하나의 논리적 기능을 수행하기 위한 작업의 단위 또는 한꺼번에 모두 수행되어야 할 일련의 연산들을 의미한다.

    - 예시) 사용자 A가 사용자 B에게 백만원을 송금한다

    1. 사용자 A의 계좌에서 백만원을 차감한다: UPDATE를 통해 사용자 A의 잔고 변경
    2. 사용자 B의 계좌에 백만원을 추가한다: UPDATE를 통해 사용자 B의 잔고 변경
    
     작업 단위: 출금 UPDATE + 입금 UPDATE => 통틀어 하나의 트랜잭션이라고 한다.
    - 위 두 쿼리문이 모두 성공적으로 완료되어야만 하나의 작업 완료

- 트랜잭션은 데이터베이스 시스템에서 병행 제어 및 회복 작업 시 처리되는 작업의 논리적 단위로 사용자가 시스템에 대한 서비스 요구 시 시스템이 응답하기 위한 상태 변환 과정의 작업 단위이다.

- 하나의 트랜잭션은 Commit 되거나 Rollback된다.

### Transaction의 성질(ACID)
1. Atomicity(원자성)
    - 트랜잭션의 연산은 데이터베이스에 모두 반영되든지 아니면 전혀 반영되지 않아야 한다.
    - 트랜잭션 내의 모든 명령은 반드시 완벽히 수행되어야 하며, 모두가 완벽히 수행되지 않고 어느 하나라도 오류가 발생하면 트랜잭션 전부가 취소되어야 한다.

2. Consistency(일관성)
    - 트랜잭션이 성공적으로 완료되면 언제나 일관성 있는 데이터베이스 상태를 유지해야 한다.
    - 시스템이 가지고 있는 고정요소는 트랜잭션 수행 전과 트랜잭션 수행 완료 후의 상태가 같아야 한다.(기본 키, 외래 키 제약과 같은 명시적인 무결성 제약 조건뿐만 아니라, 위의 예시에서 두 계좌의 잔고의 합은 이체 전후가 같아야한다는 사항 같은 비명시적인 일관성 조건도 있다.)

3. Isolation(독립성)
    - 둘 이상의 트랜잭션이 동시에 병행 실행되는 경우 어느 하나의 트랜잭션 실행 중에 다른 트랜잭션의 연산이 끼어들 수 없다.
    - 수행 중인 트랜잭션은 완전히 완료될 때까지 다른 트랜잭션에서 수행 결과를 참조할 수 없다.

4. Durablility(영구성)
    - 성공적으로 수행된 트랜잭션은 데이터베이스에 영원히 반영되어야 함을 의미한다.
    - 트랜잭션이 완료되어 저장이 된 데이터베이스는 저장 후에 생기는 정전, 장애, 오류 등에 영향을 받지 않아야 한다.

### 트랜잭션 연산 
1. Commit 
    - Commit 연산은 트랜잭션 작업을 완료했다고 확정하는 명령어로 트랜잭션 작업 내용을 실제 DB에 저장하고, DB가 변경되도록 하는 연산이다.

2. Rollback
    - 작업 중 문제가 발생했을 때, 트랜잭션 처리 과정에서 발생한 변경 사항을 취소하고, 이전 COMMIT의 상태로 되돌리는 연산이다.

### 동시성 제어(Concurrency Control)
-  여러 사용자가 있는 환경에서 둘 이상의 트랜잭션이 동시에 수행될 때, 데이터의 일관성을 해치지 않도록 하는 제어법이다. 

- 동시성 제어가 없는 경우
1. 갱신 손실(lost update)
    - 하나의 트랜잭션이 작성한 내용을 다른 트랜잭션이 덮어써서 갱신이 무효화됨
    - 두 개 이상의 트랜잭션이 하나의 데이터를 동시에 갱신할 떄 발생

2. 현황파악 오류(dirty read) 
    - 읽기 작업을 하는 트랜잭션이, 쓰기 작업을 하는 트랜잭션의 중간 데이터를 읽으면 문제가 발생할 수 있음
    - 작업중인 트랜잭션이 작업을 롤백(rollback)한 경우, 다른 트랜잭션이 무효화된 데이터를 읽게 될 수 있음

3. 모순성(inconsistency)
    - 어떤 트랜잭션이 데이터를 갱신하는 동안 다른 두 트랜잭션 중 하나는 갱신되기 전의 값을 익고 다른 하나가 갱신된 후의 값을 읽게 되어 불일치하는 경우

4. 연쇄복귀(cascading rollback)
    - 두 트랜잭션이 동일한 데이터 내용을 접근할 때 발생
    - 한 트랜잭션이 데이터를 갱신하다 실패하여 rollback하는 과정에서 다른 트랜잭션이 갱신과 rollback 연산을 실행하고 있던 데이터를 읽어서 사용하는 경우 문제 발생

- 동시성 제어 종류
1. 로킹 기법(locking method)
    - 트랜잭션이 데이터에 잠금(lock)을 설정하면 다른 트랜잭션은 해당 데이터에 대해 잠금이 해제(unlock)될 때까지 접근/수정/삭제가 불가하다.
    - 트랜잭션이 사용하는 자원에 대하여 상호 배제(Mutual Exclusive) 기능을 제공하는 기법 
    - 상호 배제는 트랜잭션이 데이터 항목에 대하여 잠금(Lock) 을 설정한 트랜잭션이 해재(UnLock) 할 때까지 데이터를 독점적으로 사용할 수 있는 것을 의미

2. 타임 스팸프(Time Stamp)
    - 트랜잭션의 순서대로 시간 스탬프를 지정하여 동시성 제어의 기준으로 사용되는 개념

3. 적합성 검증(낙관적 검증 기법)
    - 트랜잭션이 어떠한 검증도 수행하지 않고, 일단 트랜잭션을 수행하고 종료시 검증을 수행하여 데이터베이스에 반영하는 방법
    - 만약 트랜잭션의 길이가 길어 장기적으로 트랜잭션이 진행되었는데 Roll Back 되는 경우 자원 낭비
    - 동시 사용 빈도가 낮은 시스템에서 사용

4. MVCC(다중버전 동시성 제어 기법)
    - MVCC(Multi Version Concurreny Control) 는 동시 접근을 허용하는 데이터베이스에서 동시성을 제어하기 위해 사용하는 방법 중 하나
    - 동작 방법
        1. 데이터에 접근하는 사용자는 접근하는 시점에 데이터베이스 snapshot 을 읽는다.
        (이 snapshot 데이터에 대한 변경이 commit 될 때 까지의 변경사항은 다른 사용자가 볼 수 없음)
        2. 이 후 업데이트가 완료되면 이전 데이터베이스에 덮어 씌우는게 아닌 새로운 버전의 데이터를 UNDO 영역에 생성
        3. 이전 버전과 새로 생긴 영역의 데이터를 비교해서 반영

