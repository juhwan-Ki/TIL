## 웹 통신의 큰 흐름

### 요약
1. 브라우저 주소창에 google.com을 입력한다
2. 브라우저가 google.com의 IP 주소를 찾기 위해 캐시에서 DNS 기록을 확인한다
3. 만약 요청한 URL(google.com)이 캐시에 없다면, ISP의 DNS 서버가 DNS 쿼리로 google.com을 호스팅하는 서버의 IP 주소를 찾는다
4. 브라우저가 해당 서버와 TCP 연결을 시작한다
5. 브라우저가 웹서버에 HTTP 요청을 보낸다
6. 서버가 요청을 처리하고 응답을 보낸다
7. 서버가 HTTP 응답을 보낸다
8. 브라우저가 HTML 컨텐츠를 보여준다

### 1. 브라우저에 URL 입력
- 브라우저에 내가 찾을 웹 페이지의 URL을 입력한다

### 2. 브라우저가 입력한 URL의 IP 주소를 찾기 위해 캐시에서 DNS 기록을 확인한다
- DNS(Domain Name System)는 인터넷 전화번호부와 같다 DNS는 웹사이트의 IP 주소와 도메인 주소를 연결해주는 시스템이다 인터넷의 모든 URL에는 고유한 IP 주소가 할당되어 있으며, IP 주소는 액세스 요청 웹 사이트의 서버를 호스트하는 컴퓨터에 속한다
- DNS 기록을 찾기 위해서, 브라우저가 캐시를 확인하는 방법
    1. 브라우저 내에 캐시를 확인
    2. OS 내에 있는 캐시를 확인
    3. 라우터 캐시를 확인
    4. ISP 캐시를 확인한다

- 만약 위 모든 단계에서 DNS 기록을 찾지 못한다면, 브라우저는 ISP에서 DNS 기록을 찾는다 ISP(Internet Service Provider)는 DNS 서버를 가지고 있는데, 해당 서버에서 DNS 기록 캐시를 검색할 수 있다. (sk, u+ 같은 인터넷 제공사)
- 이렇게 캐싱을 하는 이유는 캐시는 네트워크 트래픽을 규제하고 데이터 전송 시간을 개선하는 데 필수적이기 때문이다

### 3. 만약 요청한 URL이 캐시에 없다면, ISP의 DNS 서버가 DNS 쿼리로 URL을 호스팅하는 서버의 IP 주소를 찾는다
- DNS 쿼리의 목적은 웹 사이트에 대한 올바른 IP 주소를 찾을 때까지 인터넷에서 여러 DNS 서버를 검색하는 것이다. 필요한 IP 주소를 찾거나, 찾을 수 없다는 오류 응답을 반환할 때까지 한 DNS 서버에서 다른 DNS 서버로 검색이 반복적으로 계속되기 때문에 이 유형의 검색을 재귀적 질의(Recursive Query)라고 한다
- 오늘날 많은 웹 사이트 URL은 3차 도메인, 2차 도메인 및 최상위 도메인(TLD: Top Level Domain)으로 이뤄진다. 각 단계에는 DNS 룩업(lookup) 도중에 쿼리되는 고유한 네임 서버가 있다
- maps.google.com의 경우 먼저 DNS 리커서가 루트 네임 서버(Root Name Server)에 연결한다 루트 이름 서버는 리커서를 .com 도메인 네임 서버로 리디렉션한다
- .com 네임 서버는 google.com 네임 서버로 리디렉션한다 google.com 네임 서버는 DNS 기록에서 maps.google.com과 일치하는 IP 주소를 찾아 DNS 리커서로 반환하고, 리커서는 이를 브라우저로 다시 보낸다
- 위와 같은 요청(Request)은 내용 및 IP 주소(DNS 리커서의 IP 주소)와 같은 정보를 작은 데이터 패킷에 담겨 전송된다 이 패킷은 올바른 DNS 서버에 도달하기 전에 클라이언트와 서버 사이의 여러 네트워킹 장비를 통해 이동한다 이 장비는 라우팅 테이블을 사용하여 패킷이 목적지에 도달할 수 있는 가장 빠른 방법을 알아낸다 만약 이동 도중에 패킷이 손실되면, 요청 실패 오류가 발생한다 그렇지 않으면 올바른 DNS 서버에 도달하여 IP 주소를 가져온 후 브라우저로 돌아간다

### 4. 브라우저가 해당 서버와 TCP 연결을 시작한다
- 브라우저가 올바른 IP 주소를 수신하면 IP 주소와 일치하는 서버와 연결해 정보를 전송한다

- 이때 TCP/IP 프로토콜을 사용하여 클라이언트와 서버간 패킷 전송을 진행해야 하는데 이때 먼저 3-way-handshake를 통해 연결을 진행한다 클라이언트와 서버가 SYN(synchronize: 연결 요청) 및 ACK(acknowledgement: 승인) 메시지를 교환하여 연결을 설정하는 3단계 프로세스이다

- 연결 방법
    1. 클라이언트는 인터넷을 통해 서버에 SYN 패킷을 보내 새 연결이 가능한지 여부를 묻는다
    2. 서버에 새 연결을 수락할 수 있는 열린 포트가 있는 경우, SYN/ACK 패킷을 사용하여 SYN 패킷의 ACK(승인)으로 응답한다
    3. 클라이언트는 서버로부터 SYN/ACK 패킷을 수신하고 ACK 패킷을 전송하여 승인한다

### 5. 브라우저가 웹서버에 HTTP 요청을 보낸다
- TCP 연결이 설정되면 데이터 전송이 시작되며 브라우저는 해당 사이트의 웹 페이지를 요청하는 GET 요청을 보낼 것이다
- 만약 자격 증명(credentials)을 입력하거나 form을 제출하는 경우 POST 요청을 사용할 수 있다 이 요청에는 브라우저 식별(User-Agent 헤더), 수락할 요청 유형(Accept 헤더) 및 추가 요청을 위해 TCP 연결을 유지하라는 연결 헤더와 같은 추가 정보도 포함된다 또한 브라우저가 이 도메인에 대해 저장한 쿠키에서 가져온 정보도 전달한다

### 6. 서버가 요청을 처리하고 응답(response)을 보낸다
- 서버에는 웹 서버(예: Apache, IIS)가 포함되어 있는데, 이는 브라우저로부터 요청을 수신하고, 해당 내용을 request handler에 전달하여 응답을 읽고 생성하는 역할을 한다 Request handler는 요청, 요청의 헤더 및 쿠키를 읽고 필요한 경우 서버의 정보를 업데이트하는 프로그램이다(NET, PHP, Ruby, ASP 등으로 작성됨) 그런 다음 response를 특정 포맷으로(JSON, XML, HTML)으로 작성한다

### 7. 서버가 HTTP 응답을 보낸다
- 서버 응답에는 요청한 웹 페이지와 함께 상태 코드(status code), 압축 유형(Content-Encoding), 페이지 캐싱 방법(Cache-Control), 설정할 쿠키, 개인 정보 등이 포함 된다

### 8. 8. 브라우저가 HTML 컨텐츠를 보여준다
- 브라우저는 응답받은 HTML을 화면에 단계별로 표시한다. 첫째, HTML 골격을 렌더링한다 그런 다음 HTML 태그를 확인하고 이미지, CSS 스타일시트, 자바스크립트 파일 등과 같은 웹 페이지의 추가 요소에 대한 GET 요청을 보낸다 정적 파일(Static File)은 브라우저에서 캐싱되므로 다음에 페이지를 방문할 때 다시 가져올 필요가 없다 그리고 마지막으로 요청한 페이지가 브라우저에 나타난다
