### 동기화 문제

- 동기화란 공유 자원에 동시에 여러 프로세스나 스레드가 접근하여 엉뚱한 값을 일거나 수정하는 문제를 말한다 
- 이러한 문제를 해결하기 위해 여러 프로세스나 스레드에게 하나의 자원에 대한 처리 권한을 주거나 순서를 조정해야 한다

### 동기화 기법
- 유저 모드 동기화
    - 커널의 힘을 빌리지 않는 동기화 기법(커널의 코드가 실행되지 않음)
    - 성능상 이점이 있으나 기능상의 제한점이 존재
    - 임계 구역, 인터락 함수를 이용한 동기화
- 커널 모드 동기화
    - 커널에서 제공하는 동기화 기능을 이용하는 기법
    - 커널 모드로의 변경이 필요하고 이는 성능 저하로 이어진다(하지만 다양한 기능을 사용할 수 있음)
    - 세마포어, 뮤텍스 등을 이용한 동기화

### 유저 모드 동기화
1. 임계 구역 기반 동기화
    - 한번에 하나의 process/thread만이 접근 가능하다
    - 임계 구역 진입을 위해 크리티컬 섹션 오브젝트를 얻는다
    - 다른 process/thread가 임계 구역에 접근 하게 되면 lock을 반환할 때까지 블로킹 되며 lock이 반환되면 블로킹 상태에서 빠져나와 lock을 얻고 임계 구역에 접근한다

2. 인터락 함수 기반의 동기화
    - 함수 내부적으로 한 순간에 하나의 process/thread에 의해서만 실행되도록 동기화된다
    - 임계 구역 기반의 동기화도 내부적으로 인터락 함수를 기반으로 구현된다 
    - 유저 모드 기반으로 동작해서 속도가 빠르다

### 커널 모드 동기화
1. 뮤텍스(Mutex)
    - 공유된 자원의 데이터를 동시에 여러 process/thread가 접근하는 것을 막아 하나의 process/thread만 접근하도록 제한하는 기법이다 
    - 다른 process/thread는 lock을 가지기 위해 대기하며 lock을 해제하는 process/thread가 있을 때 까지 공유 자원에 접근하지 못한다
    - 즉 lock을 대한 소유권이 있으며 lock을 가지고 있을 경우에만 공유 자원에 접근할 수 있고, lock을 가진 경우에만 반납할 수 있다
2. 세마포어(Semaphore)
    - 공유된 자원의 데이터를 여러 process/thread가 접근하는 것을 막아 S개의 process/thread만 공유 자원에 접근하도록 제한하는 기법이다
    - 정수형 변수 S(세마포) 값을 가용한 자원의 수로 초기화하고, 자원에 접근할 때는 `S--` 연산을 수행하여 세마포 값을 감소시키고 자원을 방출할 때는 `S++` 연산을 수행하여 세마포 값을 증가시킨다 이 때 세마포 값이 0이 되면 모든 자원이 사용 중임을 의미하고, 이후 자원을 사용하려는 프로세스는 세마포 값이 0보다 커질 때까지 block 된다
    - 세마포어의 갯수에 따라 다음과 같이 나뉜다
        - 1개 : Binary Semaphore(뮤텍스와 같다)
        - 2개 이상 : Counting Semaphore
    - 세마포어는 소유할 수 없다
        - 세마포어를 소유하지 않은 스레드가 세마포어를 해제할 수 있는 문제가 발생한다

### 임계 구역(critical section)

- 둘 이상의 process/thread가 동시에 동일한 자원에 접근하도록 하는 프로그램 코드 부분을 의미한다 
- 중요한 특징중 하나는, 한 process/thread가 자신의 임계 구역에서 수행하는 동안에는 다른 process/thread들은 그들의 임계 구역에 들어갈 수 없어야 한다는 사실이다 즉, 임계 구역 내의 코드는 원자적으로(atomically) 실행이 되어야 한다
- 원자적으로 실행 되기 위해서 각각의 process/thread는 자신의 임계 구역으로 진입하려면 진입 허가를 요청해야 한다 이 부분을 entry section이라고 하고, 진입이 허가되면 임계 구역을 실행할 수 있다 임계 구역이 끝나고 나면 exit section으로 퇴출을 하게 된다 임계 구역의 원자성을 보장하여 process/thread들이 동기화되도록 할 수 있다
- 임계 구역 필수 조건
    1. 상호 배제(Mutual exclusion) : 이미 한 process/thread가 공유 자원을 접근하는 임계 구역 코드를 수행하고 있으면 다른 process/thread는 공유 자원을 접근하는 임계 구역 코드를 수행할 수 없다 즉, 한 순간에 하나의 process/thread만 실행될 수 있다
    2. 진행(Progress) : 임계 구역에서 실행중인 process/thread가 없고 별도의 동작이 없는 process/thread만 임계 구역 진입 후보로서 참여될 수 있다
    3. 한정된 대기(Bounded Waiting) : process/thread는 임계 구역에 들어가기 위해 요청한 후 부터 해당 요청이 허용 될 때 까지 다른 process/thread들이 임계 구역에 진입하는 횟수는 제한이 있어야 한다 즉 임계 구역에 진입하려는 process/thread가 무한정 기다려서는 안된다 
